<html>
    <head>
        <title>A simple proxy servlet for GWT devmode</title>
        <link rel="stylesheet" href="/media/css/base.css">
        <link rel="stylesheet" href="/media/css/fruity.css">
    </head>
    <body>
        <div class="page header"> 
            <a href="/" class="title">Dipanjan Mukherjee</a>
            <span class="extras">
                <a href="/" class="extras">home</a>
                <a href="http://github.com/schatten" class="extras">github</a>
                <a href="/feed/rss" class="extras"
                    style="visibility:hidden;">feed</a>
            </span>
        </div>
         
<div class="page content">
    <div class="left_container">
        <h1 class="container_inner_heading">A simple proxy servlet for GWT devmode</h1>
        <div class="index_post_entry post">
            <p>Disclaimer: This post is completely based on the utility I derived
from <a href="http://kennethjorgensen.com/blog/2010/04/12/proxy-servlet-for-gwt-in-devmode/">Kenneth Jorgensen's blog post</a></p>
<p>When you start developing with GWT, you often run into the hair
pulling dead end of the dreaded "Same Origin Policy". I am sure you
have googled your way into understanding what the SOP is and why it is
in place. If like me, you use a programming language other than java
on your server, one of the easiest ways out would be to have a servlet
that proxies your requests to the non-java server (django, rails etc.).</p>
<p>I won't dump the entire java servlet file here. You can find a link
<a href="/media/resources/ProxyServlet.java">here</a>. There is a dirty hack in the servlet, I describe it later. </p>
<p>To make this work, you have to edit the web.xml file within the
WEB-INF directory within the war directory not the *.gwt.xml file.
As far as I understand, (I am a noob to GWT) the *.gwt.xml file is
to be updated with the details of a servlet when you use GWT-RPC.</p>
<p>Here is a snapshot of my web.xml.</p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</pre></div>

<div class="highlight"><pre><span class="err">&lt;</span>!DOCTYPE web-app
</pre></div>

<div class="highlight"><pre>    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;
</pre></div>

<div class="highlight"><pre>    &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;&gt;
</pre></div>

<div class="highlight"><pre>
</pre></div>

<div class="highlight"><pre><span class="nt">&lt;web-app&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="nt">&lt;servlet&gt;</span>
</pre></div>

<div class="highlight"><pre>        <span class="nt">&lt;servlet-name&gt;</span>proxy<span class="nt">&lt;/servlet-name&gt;</span>
</pre></div>

<div class="highlight"><pre>        <span class="nt">&lt;servlet-class&gt;</span>in.dmulog.gwt.ProxyServlet<span class="nt">&lt;/servlet-class&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="nt">&lt;/servlet&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="nt">&lt;servlet-mapping&gt;</span>
</pre></div>

<div class="highlight"><pre>        <span class="nt">&lt;servlet-name&gt;</span>proxy<span class="nt">&lt;/servlet-name&gt;</span>
</pre></div>

<div class="highlight"><pre>        <span class="nt">&lt;url-pattern&gt;</span>/proxy/*<span class="nt">&lt;/url-pattern&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="nt">&lt;/servlet-mapping&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="c">&lt;!-- Default page to serve --&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="nt">&lt;welcome-file-list&gt;</span>
</pre></div>

<div class="highlight"><pre>        <span class="nt">&lt;welcome-file&gt;</span>Client.html<span class="nt">&lt;/welcome-file&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="nt">&lt;/welcome-file-list&gt;</span>
</pre></div>

<div class="highlight"><pre><span class="nt">&lt;/web-app&gt;</span>
</pre></div>

<p>Okay, if you update the code according to your own setup, any
requests at <span class="inline_code">localhost:8888/proxy/asdfg/asdf</span> will be forwarded to
<span class="inline_code">localhost:8000/asdfg/asdf</span>. Or as the case may be. You can define all
this in the java servlet file. </p>
<p>Now about the dirty hack I talked about. Within the java file, line
number 68 reads:</p>
<div class="highlight"><pre><span class="n">uri</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">substring</span><span class="o">(</span><span class="mi">6</span><span class="o">));</span>
</pre></div>

<p>What the substring part does is converts
<span class="inline_code">localhost:8888/proxy/foo/bar/baz</span> to a request to
<span class="inline_code">localhost:8000/foo/bar/baz</span>. </p>
<p>If we don't use the substring hack, it remains as a request to
<span class="inline_code">localhost:8000/<em>proxy</em>/foo/bar/baz</span> which might not be useful in
your case. You can possibly do this better with splitting the string
and joining. But hey, I said it was dirty. </p>
<p>Happy coding.</p>
        </div>

        <div class="index_post_entry">
            <h3 class="index_post_title">Other posts</h3>
            <ul style="margin-top:0px;">
                <li>
                </li>
                <li>
                     <a class="index_post_title_green"
                        href="/2010/10/selection_test.html">
                        WebDev Selection Test</a>
                </li>
        </div>
    </div>
</div>

        <div class="page footer_wrapper">
            <div class="footer">
                <ul class="contact">
                    <li>&copy; Dipanjan Mukherjee</li>
                    <li>Student, Software Enthusiast</li>
                    <li>dipanjan.mu &lt;at&gt; gmail &lt;dot&gt; com</li>
                </ul>
            </div>
            <div class="footer">
                <ul class="contact">
                    <li><a class="post small"
                        href="http://github.com/schatten">github</a></li>
                    <li><a class="post small"
                        href="http://in.linkedin.com/pub/dipanjan-mukherjee/26/b6a/18a">linkedin</a></li>
                    <li>&nbsp;</li>
                </ul>
            </div>

        </div>
    </body>
</html>
